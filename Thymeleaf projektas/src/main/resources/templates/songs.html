<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="en">
<head th:replace="fragments :: head('Song list')">

</head>
<body style="background-color: black">
<nav th:replace="fragments :: menuBar('/songs')"></nav>
<h1 style="color: white" th:text="#{songs.Head_Line}"></h1>
<h4 style="color: white" th:if="${songPage.totalElements == 0}">Nothing found</h4>
<div th:unless="${songPage.totalElements == 0}">
    <div>
        <table class="table table-striped table-dark table-hover">
            <thead>
            <tr th:with="sortIconDown=${'fa-sort-down'}, sortIconUp=${'fa-sort-up'}">
                <th scope="col" th:text="#{songs.no}"></th>
                <th scope="col">
                    <a th:replace="fragments :: sortedColumn(pageData=${songPage}, sortedParamName='songName', rootPath=@{/songs}, columnName=#{songs.name}, sortIconDown=${sortIconDown}, sortIconUp=${sortIconUp})"></a>
                </th>
                <th scope="col" th:text="#{songs.album}">
                    <!--                <a th:replace="fragments :: sortedColumn(pageData=${songPage}, sortedParamName='albumString', rootPath=@{/songs}, columnName='Album', sortIconDown=${sortIconDown}, sortIconUp=${sortIconUp})"></a>-->
                </th>
                <th scope="col" th:text="#{songs.author}">
                    <!--                <a th:replace="fragments :: sortedColumn(pageData=${songPage}, sortedParamName='authorString', rootPath=@{/songs}, columnName='Author', sortIconDown=${sortIconDown}, sortIconUp=${sortIconUp})"></a>-->
                </th>
                <th scope="col">
                    <a th:replace="fragments :: sortedColumn(pageData=${songPage}, sortedParamName='playtime', rootPath=@{/songs}, columnName=#{songs.playtime}, sortIconDown=${sortIconDown}, sortIconUp=${sortIconUp})"></a>
                </th>
                <th scope="col"></th>
                <th scope="col"></th>
                <th scope="col"></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="song, i: ${songPage}">
                <td th:text="${i.index + 1}"></td>
                <td th:text="${song.songName}"></td>
                <td>
                    <span th:each="album : ${song.albumList}" th:text="${album.name} + ' '"></span>
                </td>
                <td>
                    <a th:each="author : ${song.authorList}" th:text="${author.name} + ' '"
                       th:href="@{/author/{authorId}(authorId=${author.id})}"></a>
                </td>
                <td th:text="${song.playtime}"></td>
                <td>
                    <div class="d-flex justify-content-between" sec:authorize="isAuthenticated()">
                        <form th:if="${likedSongs.contains(song)}" method="post"
                              th:action="@{/UnLikeSong/{songId}/{page}/{sort}(songId=${song.id}, page=${songPage.number}, sort=${param.sort == null ? 'songName,ASC,ignorecase' : param.sort})}">
                            <button class="btn btn-primary">
                                <i class="fa-solid fa-heart"></i>
                            </button>
                        </form>
                        <form th:unless="${likedSongs.contains(song)}" method="post"
                              th:action="@{/LikeSong/{songId}/{page}/{sort}(songId=${song.id}, page=${songPage.number}, sort=${param.sort == null ? 'songName,ASC,ignorecase' : param.sort})}">
                            <button class="btn btn-primary">
                                <i class="fa-brands fa-gratipay"></i>
                            </button>
                        </form>
                    </div>
                </td>
                <td><a class="btn btn-info" th:href="@{/songs/update/{songId}(songId=${song.id})}" th:text="#{songs.update}"></a></td>
                <td><a class="btn btn-danger" th:href="@{/songs/delete/{songId}(songId=${song.id})}" th:text="#{songs.delete}"></a></td>
            </tr>
            </tbody>
        </table>
    </div>

    <nav aria-label="Page navigation example" th:with="URI=${#httpServletRequest.requestURI}, sort=${param.sort == null ? 'songName,ASC,ignorecase' : param.sort}">
        <ul class="pagination">
            <li class="page-item" th:classappend="${!songPage.hasPrevious()} ? 'disabled'">
                <a class="page-link" th:href="@{${URI}(page=${songPage.number - 1},sort=${sort})}" th:text="#{songs.previous}"></a>
            </li>

            <li class="page-item" th:classappend="${songPage.number == (pages - 1)} ? 'active'"
                th:if="${songPage.number < 3}"
                th:each="pages : ${#numbers.sequence(1, (songPage.totalPages < 5 ? songPage.totalPages : 5))}">
                <a class="page-link" th:text="${pages}" th:href="@{${URI}(page=${pages - 1},sort=${sort})}"></a>
            </li>

            <li class="page-item" th:classappend="${songPage.number == (pages - 1)} ? 'active'"
                th:if="${songPage.number >= 3 && songPage.number > (songPage.totalPages - 3)}"
                th:each="pages : ${#numbers.sequence((songPage.totalPages < 5 ? 1 : songPage.totalPages - 4), songPage.totalPages)}">
                <a class="page-link" th:text="${pages}" th:href="@{${URI}(page=${pages - 1},sort=${sort})}"></a>
            </li>

            <li class="page-item" th:classappend="${songPage.number == (pages - 1)} ? 'active'"
                th:if="${songPage.number >= 3 && songPage.number <= (songPage.totalPages - 3)}"
                th:each="pages : ${#numbers.sequence(-1 + songPage.number, 3 + songPage.number)}">
                <a class="page-link" th:text="${pages}" th:href="@{${URI}(page=${pages - 1},sort=${sort})}"></a>
            </li>

            <li class="page-item" th:classappend="${!songPage.hasNext()} ? 'disabled'">
                <a class="page-link" th:href="@{${URI}(page=${songPage.number + 1},sort=${sort})}" th:text="#{songs.next}"></a>
            </li>
        </ul>
    </nav>
</div>
<div>
    <p style="color: white" th:text="#{songs.total_songs} + ' ' + ${songPage.totalElements}"></p>
    <p style="color: white" th:text="#{songs.total_pages} + ' ' + ${songPage.totalPages}"></p>
</div>
</body>
</html>